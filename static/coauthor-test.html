<!DOCTYPE html>
<html>
<head>
    <title>Co-author Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        .pub-item { border: 1px solid #ccc; padding: 1rem; margin: 1rem 0; }
        .coauthor { background: #e8f4fd; }
        .single-author { background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Testing Co-author Display from Live Data</h1>
    <div id="test-results">Loading...</div>
    
    <script>
    async function testCoauthors() {
        try {
            // Load the same JSON file the site uses
            const response = await fetch('/publications.json');
            const publications = await response.json();
            
            console.log('Loaded publications:', publications.length);
            
            // Get first 5 publications that should show on homepage
            const first5 = publications.slice(0, 5);
            
            function formatAuthors(authors) {
                if (!authors || authors.length === 0) return '';
                
                const sorted = authors.sort((a, b) => {
                    if (a.is_primary && !b.is_primary) return -1;
                    if (!a.is_primary && b.is_primary) return 1;
                    return 0;
                });
                
                const names = sorted.map(a => a.name);
                
                if (names.length === 1) return names[0];
                if (names.length === 2) return `${names[0]} & ${names[1]}`;
                return `${names.slice(0, -1).join(', ')} & ${names[names.length - 1]}`;
            }
            
            let html = '<h2>First 5 Publications (as they appear on homepage):</h2>';
            
            first5.forEach((pub, i) => {
                const authors = formatAuthors(pub.authors);
                const title = pub.title;
                
                let citation = title;
                if (authors && pub.coauthored) {
                    citation = `<strong>${authors}</strong> (${pub.year || 'n.d.'}). ${title}`;
                } else if (pub.year && pub.year !== 'n.d.') {
                    citation = `${title} (${pub.year})`;
                }
                
                const cssClass = pub.coauthored ? 'coauthor' : 'single-author';
                
                html += `
                    <div class="pub-item ${cssClass}">
                        <h3>Publication ${i+1}</h3>
                        <p><strong>Coauthored:</strong> ${pub.coauthored}</p>
                        <p><strong>Authors data:</strong> ${JSON.stringify(pub.authors)}</p>
                        <p><strong>Formatted authors:</strong> "${authors}"</p>
                        <p><strong>Final display:</strong></p>
                        <div style="border: 1px solid #999; padding: 0.5rem; background: white;">
                            <div style="color: #2563eb; font-size: 0.8rem; font-weight: 600;">${pub.year || 'n.d.'}</div>
                            <div>${citation}</div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('test-results').innerHTML = html;
            
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('test-results').innerHTML = `<p>Error: ${error.message}</p>`;
        }
    }
    
    // Load when page is ready
    testCoauthors();
    </script>
</body>
</html>